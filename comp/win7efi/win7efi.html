
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- common.css -->
    <style>* {-webkit-tap-highlight-color: rgba(0,0,0,0);}html {-webkit-text-size-adjust: none;}body {font-family: -apple-system, Helvetica, Arial, sans-serif;margin: 0;padding: 20px;color: #333;word-wrap: break-word;}h1, h2, h3, h4, h5, h6 {line-height: 1.1;}img {max-width: 100% !important;height: auto;}blockquote {margin: 0;padding: 0 15px;color: #777;border-left: 4px solid #ddd;}hr {background-color: #ddd;border: 0;height: 1px;margin: 15px 0;}code {font-family: Menlo, Consolas, 'Ubuntu Mono', Monaco, 'source-code-pro', monospace;line-height: 1.4;margin: 0;padding: 0.2em 0;font-size: 90%;background-color: rgba(0,0,0,0.04);border-radius: 3px;}pre > code {margin: 0;padding: 0;font-size: 100%;word-break: normal;background: transparent;border: 0;}ol {list-style-type: decimal;}ol ol, ul ol {list-style-type: lower-latin;}ol ol ol, ul ol ol, ul ul ol, ol ul ol {list-style-type: lower-roman;}table {border-spacing: 0;border-collapse: collapse;margin-top: 0;margin-bottom: 16px;}table th {font-weight: bold;}table th, table td {padding: 6px 13px;border: 1px solid #ddd;}table tr {border-top: 1px solid #ccc;}table tr:nth-child(even) {background-color: #f8f8f8;}input[type="checkbox"] {cursor: default;margin-right: 0.5em;font-size: 13px;}.task-list-item {list-style-type: none;}.task-list-item+.task-list-item {margin-top: 3px;}.task-list-item input {float: left;margin: 0.3em 1em 0.25em -1.6em;vertical-align: middle;}#tag-field {margin: 8px 2px 10px;}#tag-field .tag {display: inline-block;background: #cadff3;border-radius: 4px;padding: 1px 8px;color: black;font-size: 12px;margin-right: 10px;line-height: 1.4;}</style>
    <!-- ace-static.css -->
    <style>.ace_static_highlight {white-space: pre-wrap;}.ace_static_highlight .ace_gutter {width: 2em;text-align: right;padding: 0 3px 0 0;margin-right: 3px;}.ace_static_highlight.ace_show_gutter > .ace_line {padding-left: 2.6em;}.ace_static_highlight .ace_line {position: relative;}.ace_static_highlight .ace_gutter-cell {-moz-user-select: -moz-none;-khtml-user-select: none;-webkit-user-select: none;user-select: none;top: 0;bottom: 0;left: 0;position: absolute;}.ace_static_highlight .ace_gutter-cell:before {content: counter(ace_line, decimal);counter-increment: ace_line;}.ace_static_highlight {counter-reset: ace_line;}</style>
    <style>.ace-monokai .ace_gutter {background: #2F3129;color: #8F908A}.ace-monokai .ace_print-margin {width: 1px;background: #555651}.ace-monokai {background-color: #272822;color: #F8F8F2}.ace-monokai .ace_cursor {color: #F8F8F0}.ace-monokai .ace_marker-layer .ace_selection {background: #49483E}.ace-monokai.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px #272822;}.ace-monokai .ace_marker-layer .ace_step {background: rgb(102, 82, 0)}.ace-monokai .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #49483E}.ace-monokai .ace_marker-layer .ace_active-line {background: #202020}.ace-monokai .ace_gutter-active-line {background-color: #272727}.ace-monokai .ace_marker-layer .ace_selected-word {border: 1px solid #49483E}.ace-monokai .ace_invisible {color: #52524d}.ace-monokai .ace_entity.ace_name.ace_tag,.ace-monokai .ace_keyword,.ace-monokai .ace_meta.ace_tag,.ace-monokai .ace_storage {color: #F92672}.ace-monokai .ace_punctuation,.ace-monokai .ace_punctuation.ace_tag {color: #fff}.ace-monokai .ace_constant.ace_character,.ace-monokai .ace_constant.ace_language,.ace-monokai .ace_constant.ace_numeric,.ace-monokai .ace_constant.ace_other {color: #AE81FF}.ace-monokai .ace_invalid {color: #F8F8F0;background-color: #F92672}.ace-monokai .ace_invalid.ace_deprecated {color: #F8F8F0;background-color: #AE81FF}.ace-monokai .ace_support.ace_constant,.ace-monokai .ace_support.ace_function {color: #66D9EF}.ace-monokai .ace_fold {background-color: #A6E22E;border-color: #F8F8F2}.ace-monokai .ace_storage.ace_type,.ace-monokai .ace_support.ace_class,.ace-monokai .ace_support.ace_type {font-style: italic;color: #66D9EF}.ace-monokai .ace_entity.ace_name.ace_function,.ace-monokai .ace_entity.ace_other,.ace-monokai .ace_entity.ace_other.ace_attribute-name,.ace-monokai .ace_variable {color: #A6E22E}.ace-monokai .ace_variable.ace_parameter {font-style: italic;color: #FD971F}.ace-monokai .ace_string {color: #E6DB74}.ace-monokai .ace_comment {color: #75715E}.ace-monokai .ace_indent-guide {background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAEklEQVQImWPQ0FD0ZXBzd/wPAAjVAoxeSgNeAAAAAElFTkSuQmCC) right repeat-y}</style>
    <!-- export.css -->
    <style>
body{margin:0 auto;max-width:800px;line-height:1.4}
#nav{margin:5px 0 10px;font-size:15px}
#titlearea{border-bottom:1px solid #ccc;font-size:17px;padding:10px 0;}
#contentarea{font-size:15px;margin:16px 0}
.cell{outline:0;min-height:20px;margin:5px 0;padding:5px 0;}
.code-cell{font-family:Menlo,Consolas,'Ubuntu Mono',Monaco,'source-code-pro',monospace;font-size:12px;}
.latex-cell{white-space:pre-wrap;}
    </style>
    <!-- User CSS -->
    <style> .text-cell {font-size: 15px;}.code-cell {font-size: 12px;}.markdown-cell {font-size: 15px;}.latex-cell {font-size: 15px;}</style>
    <style>
.bg-image {
  background-image: url('img/win-header.jpg');
  background-repeat: no-repeat;
  background-size: cover;
  background-position: center;
  text-align: center;
  color: #EEE;
  padding-top: 25%;
  padding-bottom: 25%;
  text-shadow: 2px 2px 8px #333;
}
    </style>
  </head>
  <body>

    <div id="titlearea">
      <h2>MBP5,1 WIN 7 X64 EFI</h2>
    </div>
    <div id="contentarea"><div class="cell markdown-cell"><h1 class="bg-image"><i>The Mac's EFI won't support it, huh?</i></h1>
        <h2>How I got 64-bit Windows 7 booting in EFI on a Late 2008 unibody MacBook Pro</h2>
        <h2>Why?</h2>
        <p><strong>Because I can.</strong></p>
        <p>Actually, it's because Apple's BIOS Emulation setup for Bootcamp doesn't allow you to use both of the GPUs that are built-in (GeForce 9400M and Geforce 9600M GT). BIOS Emulation restricts you to just the 9600M GT, which produces a lot of heat and drains the battery fairly quickly (thanks to terrible power management). While it's great for gaming, it's overkill for simpler tasks that you may need Windows for. Booting up Windows using the MacBook's native EFI allows you to have access to both GPUs, and gives you a bit more control of what they do.</p>
        <h3>My original MacRumors post</h3>
        <p>This goes way back to 2014 when I first figured this out. I posted my documentation on MacRumors to see if it would help them out. To the best of my knowledge, I may have been the only one who got as far as booting up using the 9400M with the 9600M GT, but there were also a lot of pages that I didn't read. Nonetheless, here it is:</p>
        <p><a href="http://forums.macrumors.com/threads/win7-x64-booting-natively-via-efi-no-bios-emulation.696523/page-42#post-20529412">Post #1045 Dec 26, 2014</a></p>
        <blockquote>
          <p>Lord have mercy this thread is still going! :p</p>
          <p>Anyway, I just registered on the forum so I could post this and hopefully help someone who is stuck in my case. I figured this out earlier last year but never got around to posting it. I have no idea if I'm actually too late to post this because I didn't bother to scroll through the 30-or-so pages that weren't there last time I was on this thread ;)</p>
          <p>I've figured out how to switch and enable/disable the graphics card on the MacBook5,1 (9400+9600) in the rEFIt EFI shell itself.</p>
          <p>This applies to Windows 7 only, as I have not tested Windows 8 on mine (and frankly, screw Win8 XD)</p>
          <p>This will allow you to use either the 9400M and disable the 9600M GT in Windows, thus saving power, OR, enable BOTH the GPUs and have whatever Windows software you want utilizing them both. NOTE: you still can't switch actual displays on the fly, but applications can take advantage o both graphics cards at once. Yes, I know some of you are probably concerned about overheating, but trust me, it's not an issue. This laptop is so well engineered that I've never seen the temps rise to a critical level. Obviously, make sure it have proper ventilation, etc...</p>
          <p>This is all the documentation I have written down for myself, hope you guys find it useful.</p>
          <p>Documentation:</p>
          <p>PCI Device 02 00 00 &lt;- Nvidia GeForce 9600M GT (also device E5)<br>
          PCI Device 03 00 00 &lt;- Nvidia GeForce 9400M (also device E7)</p>
          <p>#### How to switch between GPUs ####<br>
          User <code>dmpstore gpu-power-prefs</code> to check with GPU has power<br>
          <code>dmpstore gpu-power-prefs -s fs0:\gpu-power-prefs #store the existing setting on the EFI partition</code></p>
          <p>#edit the GPU power setting to power on the card that will be the display output<br>
          <code>hexedit gpu-power-prefs</code><br>
          <code>00 00 00 00 corresponds to discrete GPU</code><br>
          <code>01 00 00 00 corresponds to integrated GPU</code></p>
          <p>Reset NVRAM if you screw something up</p>
          <p>REBOOT AFTER CHANGING and check <code>dh e5</code> or <code>dh e7</code>. Don't set the <code>gpu-power-prefs</code> and try to boot directly into Windows, it won't work.</p>
          <p>After rebooting, you need to set the VGA controller for Windows to use when displaying output:</p>
          <p>NOTE: DO NOT ENABLE BOTH VGA CONTROLLERS AT THE SAME TIME. Windows won't boot. Windows prefers that only one VGA controller is in charge of video output.</p>
          <p>To power on the 9600:<br>
          <code>mm 0750 -IO 3</code></p>
          <p>Conversely, to power it off:<br>
          <code>mm 0750 -IO 0</code></p>
          <p>To set its bus master and enable VGA for the 9600</p>
          <p><code>mm 000C003E -PCI 8</code><br>
          Setting register 3E to 8 enables VGA on the PCI bridge for the 9600 is 00 0C 00 that bridge (0C)</p>
          <p><code>mm 02000004 -PCI 7</code><br>
          Setting register 04 on bus 02 device 00 to 7 enables bus master and activates the 9600</p>
          <p>Boot Windows with <code>fs2:EFI\BOOT\BOOTX64.EFI</code> (change fs2 to your drive number)</p>
          <p>Enable VGA on the 9400:</p>
          <p><code>mm 0010003E -PCI 8</code><br>
          Set register 3E on bus 00 device 10 (PCI bridge for integrated graphics) to 8 to enable VGA</p>
          <p><code>mm 03000004 -PCI 7</code><br>
          Set register 04 on bus 03 (9400 bus) to 7 to enable bus master and activate the 9400.</p>
          <p>Setting register 3E to 8 on either device 0C (discrete)<br>
          or device 10 (integrated) will enable VGA for that respective<br>
          GPU. Setting register 04 on either bus 02 or bus 03 will<br>
          enable the corresponding GPU. Power off the 9600 (mm 0750 -IO 0)<br>
          to save juice when using the 9400.</p>
          <p>You can check the values for the buses/devices using:</p>
          <p><code>pci -i 00 0C 00 -b</code> (the PCI-X bridge)</p>
          <p><code>pci -i 00 10 00 -b</code> (the PCI integrated bridge)</p>
          <p><code>dh e5 -b</code> (the discrete 9600 device)</p>
          <p><code>dh e7 -b</code> (the integrated 9400)</p>
          <p><code>pci -i 02 00 00 -b</code> (for the discrete gpu)</p>
          <p><code>pci -i 03 00 00 -b</code> (for the integrated gpu)</p>
          <p>Hope this helps, sorry again if I'm late and someone has already figured this out. Cheers!~</p>
        </blockquote>
        <h3>The results speak for themselves:</h3>
        <i>(right-click -> open in new tab for the full resolution)</i>
        <p><img src="img/everything_gfx.png" alt="proof suckas" width="1440" height="900"></p>
      </div></div>
      <script></script>
  </body>
</html>

